<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testimonials - SC Website</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <!-- Header -->
    <div class="bg-primary text-white py-4 mb-4 rounded-bottom-3 shadow">
        <div class="container">
            <h1 class="text-center mb-0">Customer Testimonials</h1>
            <p class="text-center mb-0">See what our customers are saying about us</p>
        </div>
    </div>

    <div class="container">
        <!-- Testimonial Form -->
        <div class="card shadow-sm mb-4">
            <div class="card-body p-4">
                <h2 class="card-title mb-4">Share Your Experience</h2>
                <form id="testimonialForm">
                    <div class="mb-3">
                        <label for="nameInput" class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="nameInput" placeholder="Enter your name" required>
                    </div>
                    <div class="mb-3">
                        <label for="messageInput" class="form-label">Your Message</label>
                        <textarea class="form-control" id="messageInput" rows="4" placeholder="Enter your testimonial message" required></textarea>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">Submit Testimonial</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Testimonials Section -->
        <h2 class="mb-4 pb-2 border-bottom">What Our Customers Say</h2>
        <div id="testimonialsContainer">
            <!-- Testimonials will be dynamically added here -->
            <div class="text-center py-5 text-muted" id="emptyState">
                <h4>No testimonials yet</h4>
                <p>Be the first to share your experience!</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <p class="text-center mb-0">&copy; 2023 SC Website. All rights reserved.</p>
        </div>
    </footer>

    <!-- Edit Testimonial Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Testimonial</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="mb-3">
                            <label for="editName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="editName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="editMessage" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEditBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this testimonial?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // DOM elements
        const testimonialForm = document.getElementById('testimonialForm');
        const testimonialsContainer = document.getElementById('testimonialsContainer');
        const emptyState = document.getElementById('emptyState');
        const editModal = new bootstrap.Modal(document.getElementById('editModal'));
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        const saveEditBtn = document.getElementById('saveEditBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

        // Testimonials array (initially empty)
        let testimonials = [];
        let testimonialToDelete = null;

        // Sample initial testimonials
        const initialTestimonials = [
            {
                id: 1,
                name: "Ritu",
                message: "It has been a positive experience with personable banking service in a timely manner",
                date: "2023-10-15"
            }
        ];

        // Load testimonials from localStorage on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTestimonials = localStorage.getItem('testimonials');
            if (savedTestimonials) {
                testimonials = JSON.parse(savedTestimonials);
            } else {
                // Load initial testimonials if no saved data
                testimonials = initialTestimonials;
                saveTestimonials();
            }
            renderTestimonials();
        });

        // Handle form submission
        testimonialForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nameInput = document.getElementById('nameInput');
            const messageInput = document.getElementById('messageInput');
            
            // Create new testimonial object
            const newTestimonial = {
                id: Date.now(), // Using timestamp as unique ID
                name: nameInput.value.trim(),
                message: messageInput.value.trim(),
                date: new Date().toLocaleDateString()
            };
            
            // Add to testimonials array
            testimonials.push(newTestimonial);
            
            // Save to localStorage
            saveTestimonials();
            
            // Re-render testimonials
            renderTestimonials();
            
            // Reset form
            testimonialForm.reset();
            
            // Show success alert
            showAlert('Testimonial added successfully!', 'success');
        });

        // Render all testimonials
        function renderTestimonials() {
            // Hide empty state if there are testimonials
            if (testimonials.length > 0) {
                emptyState.style.display = 'none';
            } else {
                emptyState.style.display = 'block';
                return;
            }
            
            // Clear container
            testimonialsContainer.innerHTML = '';
            
            // Add each testimonial to the container
            testimonials.forEach(testimonial => {
                const testimonialElement = createTestimonialElement(testimonial);
                testimonialsContainer.appendChild(testimonialElement);
            });
        }

        // Create testimonial HTML element
        function createTestimonialElement(testimonial) {
            const card = document.createElement('div');
            card.className = 'card mb-3 shadow-sm';
            card.setAttribute('data-id', testimonial.id);
            
            card.innerHTML = `
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">${escapeHtml(testimonial.name)}</h5>
                    <div>
                        <button class="btn btn-outline-primary btn-sm me-1 btn-edit" data-id="${testimonial.id}">Edit</button>
                        <button class="btn btn-outline-danger btn-sm btn-delete" data-id="${testimonial.id}">Delete</button>
                    </div>
                </div>
                <div class="card-body">
                    <p class="card-text">${escapeHtml(testimonial.message)}</p>
                    <small class="text-muted">Posted on ${testimonial.date}</small>
                </div>
            `;
            
            // Add event listeners to edit and delete buttons
            const editBtn = card.querySelector('.btn-edit');
            const deleteBtn = card.querySelector('.btn-delete');
            
            editBtn.addEventListener('click', () => openEditModal(testimonial.id));
            deleteBtn.addEventListener('click', () => openDeleteModal(testimonial.id));
            
            return card;
        }

        // Open edit modal with testimonial data
        function openEditModal(id) {
            const testimonial = testimonials.find(t => t.id === id);
            if (!testimonial) return;
            
            document.getElementById('editId').value = testimonial.id;
            document.getElementById('editName').value = testimonial.name;
            document.getElementById('editMessage').value = testimonial.message;
            
            editModal.show();
        }

        // Handle save edit button click
        saveEditBtn.addEventListener('click', function() {
            const id = parseInt(document.getElementById('editId').value);
            const name = document.getElementById('editName').value.trim();
            const message = document.getElementById('editMessage').value.trim();
            
            if (!name || !message) {
                showAlert('Please fill in all fields', 'danger');
                return;
            }
            
            // Find and update testimonial
            const testimonialIndex = testimonials.findIndex(t => t.id === id);
            if (testimonialIndex !== -1) {
                testimonials[testimonialIndex].name = name;
                testimonials[testimonialIndex].message = message;
                
                // Save to localStorage
                saveTestimonials();
                
                // Re-render testimonials
                renderTestimonials();
                
                // Close modal
                editModal.hide();
                
                // Show success alert
                showAlert('Testimonial updated successfully!', 'success');
            }
        });

        // Open delete confirmation modal
        function openDeleteModal(id) {
            testimonialToDelete = id;
            deleteModal.show();
        }

        // Handle delete confirmation
        confirmDeleteBtn.addEventListener('click', function() {
            if (testimonialToDelete) {
                testimonials = testimonials.filter(t => t.id !== testimonialToDelete);
                
                // Save to localStorage
                saveTestimonials();
                
                // Re-render testimonials
                renderTestimonials();
                
                // Close modal
                deleteModal.hide();
                
                // Show success alert
                showAlert('Testimonial deleted successfully!', 'success');
                
                testimonialToDelete = null;
            }
        });

        // Save testimonials to localStorage
        function saveTestimonials() {
            localStorage.setItem('testimonials', JSON.stringify(testimonials));
        }

        // Show alert message
        function showAlert(message, type) {
            // Remove existing alerts
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // Create new alert
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show mt-3`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // Insert after the form
            testimonialForm.parentNode.insertBefore(alertDiv, testimonialForm.nextSibling);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // Helper function to escape HTML (prevent XSS)
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
