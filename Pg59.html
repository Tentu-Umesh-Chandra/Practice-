<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testimonials</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <!-- Testimonial Form -->
        <div class="card mb-4 border-primary">
            <div class="card-body bg-primary bg-opacity-10">
                <h2 class="card-title mb-3 text-primary">Share Your Experience</h2>
                <form id="testimonialForm">
                    <div class="row align-items-center mb-3">
                        <div class="col-md-2">
                            <label class="form-label mb-0 fw-bold">Name</label>
                        </div>
                        <div class="col-md-10">
                            <input type="text" class="form-control" id="nameInput" placeholder="Enter your name" required>
                        </div>
                    </div>
                    <div class="row align-items-center mb-4">
                        <div class="col-md-2">
                            <label class="form-label mb-0 fw-bold">Message</label>
                        </div>
                        <div class="col-md-10">
                            <textarea class="form-control" id="messageInput" rows="3" placeholder="Enter your message" required></textarea>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary w-100" id="submitBtn">Submit Testimonial</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Testimonials Section -->
        <h2 class="mb-3">What Our Customers Say</h2>
        <div id="testimonialsContainer">
            <!-- Testimonials will be dynamically added here -->
            <div class="text-center py-5 text-muted" id="emptyState">
                <h4>No testimonials yet</h4>
                <p>Be the first to share your experience!</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // DOM elements
        const testimonialForm = document.getElementById('testimonialForm');
        const testimonialsContainer = document.getElementById('testimonialsContainer');
        const emptyState = document.getElementById('emptyState');
        const submitBtn = document.getElementById('submitBtn');

        // Testimonials array
        let testimonials = [];
        let currentlyEditingId = null;

        // Sample initial testimonials
        const initialTestimonials = [
            {
                id: 1,
                name: "Ritu",
                message: "It has been a positive experience with personable banking service in a timely manner"
            }
        ];

        // Load testimonials from localStorage on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTestimonials = localStorage.getItem('testimonials');
            if (savedTestimonials) {
                testimonials = JSON.parse(savedTestimonials);
            } else {
                testimonials = initialTestimonials;
                saveTestimonials();
            }
            renderTestimonials();
        });

        // Handle form submission
        testimonialForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nameInput = document.getElementById('nameInput');
            const messageInput = document.getElementById('messageInput');
            const name = nameInput.value.trim();
            const message = messageInput.value.trim();
            
            if (!name || !message) {
                return;
            }
            
            if (currentlyEditingId) {
                // Update existing testimonial
                updateTestimonial(currentlyEditingId, name, message);
            } else {
                // Create new testimonial
                const newTestimonial = {
                    id: Date.now(),
                    name: name,
                    message: message
                };
                
                testimonials.push(newTestimonial);
                saveTestimonials();
                renderTestimonials();
            }
            
            // Reset form
            testimonialForm.reset();
            currentlyEditingId = null;
            submitBtn.textContent = 'Submit Testimonial';
            submitBtn.classList.remove('btn-warning');
            submitBtn.classList.add('btn-primary');
        });

        // Render all testimonials
        function renderTestimonials() {
            // Clear container first
            testimonialsContainer.innerHTML = '';
            
            if (testimonials.length > 0) {
                emptyState.style.display = 'none';
                
                // Add each testimonial to the container
                testimonials.forEach(testimonial => {
                    const testimonialElement = createTestimonialElement(testimonial);
                    testimonialsContainer.appendChild(testimonialElement);
                });
            } else {
                emptyState.style.display = 'block';
            }
        }

        // Create testimonial HTML element
        function createTestimonialElement(testimonial) {
            const card = document.createElement('div');
            card.className = 'card mb-3 border-primary';
            card.setAttribute('data-id', testimonial.id);
            
            card.innerHTML = `
                <div class="card-body bg-primary bg-opacity-10">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title mb-0 text-primary">${escapeHtml(testimonial.name)}</h5>
                        <div>
                            <button class="btn btn-outline-primary btn-sm me-1 btn-edit" data-id="${testimonial.id}">Edit</button>
                            <button class="btn btn-outline-danger btn-sm btn-delete" data-id="${testimonial.id}">Delete</button>
                        </div>
                    </div>
                    <p class="card-text mb-0">${escapeHtml(testimonial.message)}</p>
                </div>
            `;
            
            const editBtn = card.querySelector('.btn-edit');
            const deleteBtn = card.querySelector('.btn-delete');
            
            editBtn.addEventListener('click', () => editTestimonial(testimonial.id));
            deleteBtn.addEventListener('click', () => deleteTestimonial(testimonial.id));
            
            return card;
        }

        // Edit testimonial - populate form with existing data
        function editTestimonial(id) {
            const testimonial = testimonials.find(t => t.id === id);
            if (!testimonial) return;
            
            document.getElementById('nameInput').value = testimonial.name;
            document.getElementById('messageInput').value = testimonial.message;
            currentlyEditingId = id;
            submitBtn.textContent = 'Update Testimonial';
            submitBtn.classList.remove('btn-primary');
            submitBtn.classList.add('btn-warning');
            
            // Scroll to form
            testimonialForm.scrollIntoView({ behavior: 'smooth' });
        }

        // Update testimonial
        function updateTestimonial(id, name, message) {
            const testimonialIndex = testimonials.findIndex(t => t.id === id);
            if (testimonialIndex !== -1) {
                testimonials[testimonialIndex].name = name;
                testimonials[testimonialIndex].message = message;
                saveTestimonials();
                renderTestimonials();
            }
        }

        // Delete testimonial directly without confirmation
        function deleteTestimonial(id) {
            // Remove from array
            testimonials = testimonials.filter(t => t.id !== id);
            
            // Save to localStorage
            saveTestimonials();
            
            // Re-render testimonials immediately
            renderTestimonials();
            
            // If we were editing the deleted testimonial, reset the form
            if (currentlyEditingId === id) {
                testimonialForm.reset();
                currentlyEditingId = null;
                submitBtn.textContent = 'Submit Testimonial';
                submitBtn.classList.remove('btn-warning');
                submitBtn.classList.add('btn-primary');
            }
        }

        // Save testimonials to localStorage
        function saveTestimonials() {
            localStorage.setItem('testimonials', JSON.stringify(testimonials));
        }

        // Helper function to escape HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
